# 每周菜谱推送使用指南

## 📅 功能说明

**每周菜谱推送系统**会在每个工作日的前一天晚上8点（北京时间），自动推送明日的菜谱到您的邮箱。

### ✨ 核心特性

1. **1荤1素科学搭配**
   - 自动选择1个荤菜 + 1个素菜
   - 确保营养均衡

2. **低油低盐健康标准**
   - 优先推荐低油低盐菜品
   - 用油 < 80g/份，用盐 < 15g/份

3. **食材购买链接**
   - 自动识别菜品所需食材
   - 提供美团小象超市购买链接
   - 一键购买所需食材

4. **智能推送时间**
   - 周日晚8点 → 推送周一菜谱
   - 周一晚8点 → 推送周二菜谱
   - 周二晚8点 → 推送周三菜谱
   - 周三晚8点 → 推送周四菜谱
   - 周四晚8点 → 推送周五菜谱

## 🚀 快速开始

### 本地测试

```bash
# 1. 设置环境变量
export FROM_EMAIL="your@qq.com"
export EMAIL_PASSWORD="your_auth_code"
export SMTP_SERVER="smtp.qq.com"
export SMTP_PORT="465"

# 2. 运行脚本
cd scripts
python weekly_recipe_sender.py
```

### GitHub Actions 自动化

1. **配置 GitHub Secrets**
   
   在仓库 Settings → Secrets and variables → Actions 添加：
   - `FROM_EMAIL`: 发件邮箱
   - `EMAIL_PASSWORD`: 邮箱授权码

2. **启用 Actions**
   
   - 进入仓库 Actions 页面
   - 找到 "每周菜谱推送" workflow
   - 点击 Enable workflow

3. **手动测试**
   
   - 在 Actions 页面选择 workflow
   - 点击 "Run workflow" 手动触发
   - 检查邮箱是否收到

## 📧 邮件内容

邮件包含以下内容：

### 1. 菜品详情
- **荤菜**：含肉类/海鲜的主菜
  - 菜品名称
  - 配料清单
  - 制作步骤
  
- **素菜**：纯蔬菜/豆制品菜肴
  - 菜品名称
  - 配料清单
  - 制作步骤

### 2. 购买清单
- 所有所需食材列表
- 每个食材配有美团小象超市购买链接
- 点击即可跳转购买

### 3. 一键购买按钮
- 直达美团小象超市
- 方便快捷采购

## 🔧 自定义配置

### 修改收件邮箱

编辑 `scripts/weekly_recipe_sender.py` 最后一行：

```python
target_email = "huzhe06@gmail.com"  # 改为你的邮箱
```

### 修改推送时间

编辑 `.github/workflows/weekly-recipe.yml`：

```yaml
schedule:
  # 当前：工作日前一天晚上8点（北京时间）
  - cron: '0 12 * * 0-4'  # UTC 12:00 = 北京 20:00
  
  # 如果要改为晚上9点：
  # - cron: '0 13 * * 0-4'  # UTC 13:00 = 北京 21:00
```

**Cron 表达式说明：**
- `0 12 * * 0-4`: 周日到周四的 UTC 12:00（北京晚8点）
- 周日=0, 周一=1, ..., 周六=6
- 北京时间 = UTC时间 + 8小时

### 调整荤素判断标准

编辑 `scripts/weekly_recipe_sender.py`：

```python
# 荤菜关键词
self.meat_keywords = ['肉', '鸡', '鸭', '鱼', '虾', '牛', '猪', ...]

# 素菜关键词
self.veg_keywords = ['青菜', '白菜', '西兰花', '豆腐', ...]
```

### 修改油盐标准

在 `is_low_oil_salt` 方法中修改：

```python
# 低油：每份用油少于80g
is_low_oil = total_oil < 80

# 低盐：每份用盐少于15g
is_low_salt = total_salt < 15
```

### 添加更多食材链接

编辑 `scripts/ingredient_links.py`，在 `INGREDIENT_LINKS` 字典中添加：

```python
INGREDIENT_LINKS = {
    '新食材': 'https://s.meituan.com/v1/.../search/1?q=新食材',
    ...
}
```

## 🛒 美团小象超市说明

### 为什么选择美团小象超市？

1. **覆盖面广**：一线及新一线城市都有服务
2. **品质保证**：生鲜食材新鲜度有保障
3. **配送快速**：最快30分钟送达
4. **价格合理**：经常有优惠活动

### 如何使用购买链接？

1. 点击邮件中的食材链接
2. 跳转到美团小象超市App或网页
3. 查看商品并加入购物车
4. 选择配送时间和地址
5. 完成支付

### 替换其他购买渠道

如果想使用其他平台（如盒马、叮咚买菜等），可以修改 `ingredient_links.py` 中的链接模板。

## 📊 菜品筛选逻辑

### 荤菜筛选条件
1. 菜名或内容包含：肉、鸡、鸭、鱼、虾、牛、猪等关键词
2. 符合低油低盐标准
3. 来自炒菜、蒸菜、炖菜类别

### 素菜筛选条件
1. 不含荤菜关键词
2. 包含蔬菜、豆制品关键词
3. 符合低油低盐标准
4. 来自烫菜、凉拌、蒸菜、炒菜类别

### 健康标准
- **低油**：用油量 < 80克/份
- **低盐**：用盐量 < 15克/份
- **优先关键词**：清炒、清蒸、水煮、汆烫、浇汁、凉拌

## ❓ 常见问题

### Q1: 为什么选择的菜品不合我口味？
A: 可以修改筛选逻辑，调整荤素关键词和类别偏好。

### Q2: 某些食材链接打不开？
A: 美团小象超市可能在某些地区未开通服务，建议使用通用搜索链接或更换平台。

### Q3: 能否推送3个或更多菜品？
A: 可以修改 `select_recipes` 方法，选择更多菜品。

### Q4: 想要周末也推送怎么办？
A: 修改 cron 表达式为 `0 12 * * *`（每天都推送）。

### Q5: 美团小象超市链接失效？
A: 可以更新 `ingredient_links.py` 中的链接模板，或使用其他电商平台。

## 📝 邮件示例

```
主题：🍽️ 明日菜谱 01月15日 周一：胡萝卜炒肉片 + 浇汁西兰花

内容：
┌─────────────────────────────────┐
│   🍽️ 明日菜谱推荐                    │
│   2025年01月15日 周一               │
└─────────────────────────────────┘

💡 温馨提示：低油低盐，健康饮食。
   今日推荐1荤1素搭配，营养均衡！

【荤菜】胡萝卜炒肉片
配料：猪肉、胡萝卜、葱姜蒜...
步骤：1. ... 2. ...

【素菜】浇汁西兰花  
配料：西兰花、豉油汁...
步骤：1. ... 2. ...

🛒 一键购买所需食材
[打开美团小象超市]

📝 所需食材清单：
[猪肉] [胡萝卜] [西兰花] [葱] [姜] [蒜]
(每个食材都可点击购买)
```

## 🎯 最佳实践

1. **提前规划**
   - 晚上收到菜谱后，当晚或第二天早上购买食材
   - 新鲜食材当天烹饪口感最佳

2. **备用方案**
   - 如果某个食材买不到，可以用相似食材替换
   - 查看菜谱的配料清单，了解可替代选项

3. **健康烹饪**
   - 严格按照菜谱用量，控制油盐
   - 可以根据个人口味微调

4. **省钱技巧**
   - 关注美团小象超市的优惠活动
   - 多买常用食材，减少配送费

## 🔗 相关链接

- [主脚本](./weekly_recipe_sender.py)
- [食材链接配置](./ingredient_links.py)
- [测试脚本](./test_email.py)
- [故障排查](./TROUBLESHOOTING.md)
- [项目主页](https://github.com/Gar-b-age/CookLikeHOC)

---

祝你烹饪愉快！🍳✨

